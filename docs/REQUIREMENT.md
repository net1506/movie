# 시나리오 요구사항 분석

## 1. 서비스 개요

- 프로젝트명: 영화 예매 플랫폼
- 목적: 사용자들이 영화 좌석을 예매하고 결제까지 완료할 수 있는 시스템 구축

## 2. 주요 기능 및 시나리오

### 2.1 대기열 시스템

- 사용자는 서비스 접근 시 대기열에 자동으로 추가됨
- 대기열 순서에 따라 서비스 이용 권한이 주어짐
- 대기열에서 개별 식별 토큰을 발급하여 사용자의 접근을 제어

### 2.2 좌석 예약 기능

- 특정 날짜에 예약 가능한 좌석을 조회 가능
- 선택한 좌석은 일정 시간동안 임시 예약됨 (5분 제한)
- 임시 예약 상태에서는 다른 사용자의 동일 좌석 접근이 제한됨

### 2.3 결제 기능

- 사용자 계정에서 잔액을 충전할 수 있음
- 좌석을 선택한 후 충전된 잔액으로 결제 가능
- 결제가 완료되면 좌석 예약이 확정되고, 대기열 토큰이 만료됨

## 3. 세부 요구사항

### 3.1 유저 토큰 발급 API

- 서비스 접근을 위한 인증 토큰 발급
- 토큰에는 사용자 UUID 및 대기열 순서 정보 포함
- 일정 시간 후 토큰이 자동 만료 되도록 설정

### 3.2 예약 가능 날짜/좌석 API

- 예약 가능한 날짜 목록 제공
- 특정 날짜의 예약 가능한 좌석 정보 제공
- 좌석 번호는 각 상영관 좌석수 만큼 관리

### 3.3 좌석 예약 API

- 예약할 날짜와 좌석 정보를 입력하여 예약 요청
- 좌석은 임시 배정되며 5분간 유지됨
- 예약 시간이 초과될 경우 자동으로 좌석이 해제됨

### 3.4 잔액 관리 API

- 사용자 계정에 잔액 충전 기능 제공
- 현재 계정의 잔액을 조회할 수 있음

### 3.5 결제 API

- 선택한 좌석에 대한 결제 진행
- 졀제 완료 후 소유권이 확정됨
- 결제 완료 후 대기열 토큰 만료됨

## 4. 기술적 요구사항

### 4.1 동시 처리 및 충돌 방지

- 다수의 사용자가 같은 좌석을 동시에 예약할 경우 데이터 충돌 방지
- 데이터베이스 수준에서 적절한 락 메커니즘 도입 고려

### 4.2 분산 환경 대응

- 여러 서버 인스턴스에서 원할하게 작동할 수 있도록 설계
- 데이터 일관성을 유지하기 위한 트랜잭션 및 분산 캐시 시스템(Redis 등) 활용 고려

### 4.3 확장성과 성능 최적화

- 높은 트래픽을 감당할 수 있는 확장 가능한 구조로 설계
- 필요 시 마이크로서비스 아키텍쳐 도입 검토

### 4.4 보안 강화

- 토큰 기반 인증 및 암호화 적용
- 사용자 권한 검증 및 보안 정책 철저히 관리

## 5. 테스트 요구사항

- 각 API에 대한 단위 테스트 최소 1개 이상 작성
- 동시성 이슈에 대한 테스트 케이스 포함
- 대기열 시스템의 정확성 검증 테스트

## 6. 심화 요구사항

- 대기열 시스템의 효율적인 관리 방안 제시
- e.g. 특정 시간 동안 N 명에게만 권한을 부여한다.
- e.g. 한번에 활성화된 최대 유저를 N 으로 유지한다.
